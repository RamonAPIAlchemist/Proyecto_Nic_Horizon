{% extends 'base.html' %}

{% block titulo %}Dashboard Administrativo - Nic_Horizon{% endblock %}

{% block contenido %}
<div class="container-fluid mt-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary fw-bold">
      <i class="fas fa-chart-line me-2"></i>Dashboard Administrativo
    </h2>
    <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">
      <i class="fas fa-sign-out-alt me-1"></i>Cerrar sesi√≥n
    </a>
  </div>

  <!-- Mensajes Flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages mb-4">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
            <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Estad√≠sticas r√°pidas -->
  <div class="row mb-4">
    <div class="col-md-3 mb-3">
      <div class="card stat-card shadow-sm border-0">
        <div class="card-body p-3">
          <div class="d-flex align-items-center">
            <div class="stat-icon-container bg-primary">
              <i class="fas fa-users text-white"></i>
            </div>
            <div class="ms-3">
              <h6 class="card-title text-muted mb-1">Usuarios</h6>
              <p class="card-text display-6 fw-bold text-primary mb-0">{{ total_usuarios }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card stat-card shadow-sm border-0">
        <div class="card-body p-3">
          <div class="d-flex align-items-center">
            <div class="stat-icon-container bg-success">
              <i class="fas fa-box-open text-white"></i>
            </div>
            <div class="ms-3">
              <h6 class="card-title text-muted mb-1">Publicaciones</h6>
              <p class="card-text display-6 fw-bold text-success mb-0">{{ total_publicaciones }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card stat-card shadow-sm border-0">
        <div class="card-body p-3">
          <div class="d-flex align-items-center">
            <div class="stat-icon-container bg-warning">
              <i class="fas fa-comments text-white"></i>
            </div>
            <div class="ms-3">
              <h6 class="card-title text-muted mb-1">Comentarios</h6>
              <p class="card-text display-6 fw-bold text-warning mb-0">{{ total_comentarios }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card stat-card shadow-sm border-0">
        <div class="card-body p-3">
          <div class="d-flex align-items-center">
            <div class="stat-icon-container bg-info">
              <i class="fas fa-handshake text-white"></i>
            </div>
            <div class="ms-3">
              <h6 class="card-title text-muted mb-1">Ruedas de Negocio</h6>
              <p class="card-text display-6 fw-bold text-info mb-0">{{ ruedas|length }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de usuarios -->
  <div class="card mb-4 shadow-sm border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <div>
        <i class="fas fa-users me-2"></i> Usuarios Registrados
        <span class="badge bg-light text-primary ms-2">{{ total_usuarios }}</span>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Foto</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Emprendimiento</th>
              <th>Tel√©fono</th>
              <th class="text-center pe-4">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for user in usuarios %}
            <tr class="user-row">
              <td class="ps-4">
                <div class="user-avatar">
                  <img src="{{ user.fotoPerfil or 'https://via.placeholder.com/45' }}" class="rounded-circle" width="45" height="45" alt="{{ user.nombre }}">
                </div>
              </td>
              <td>
                <div class="fw-semibold">{{ user.nombre }}</div>
                <small class="text-muted">ID: {{ user.id[:8] }}...</small>
              </td>
              <td>
                <div class="text-muted small">{{ user.correo }}</div>
              </td>
              <td>
                <span class="badge bg-light text-dark">{{ user.emprendimiento or 'Sin emprendimiento' }}</span>
              </td>
              <td>
                <span class="text-muted">{{ user.numero or 'N/A' }}</span>
              </td>
              <td class="text-center pe-4">
                <div class="btn-group btn-group-sm" role="group">
                  <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editarUsuarioModal{{ user.id }}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#eliminarUsuarioModal{{ user.id }}">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>

            <!-- Modal Editar Usuario -->
            <div class="modal fade" id="editarUsuarioModal{{ user.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-user-edit me-2"></i>Editar Usuario
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <form method="POST" action="{{ url_for('editar_usuario_dashboard', user_id=user.id) }}" id="formEditarUsuario{{ user.id }}">
                    <div class="modal-body">
                      <div class="alert alert-info">
                        <small><i class="fas fa-info-circle me-1"></i><strong>ID Usuario:</strong> {{ user.id }}</small>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Nombre *</label>
                        <input type="text" name="nombre" class="form-control" value="{{ user.nombre }}" required>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Correo *</label>
                        <input type="email" name="correo" class="form-control" value="{{ user.correo }}" required>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Tel√©fono</label>
                        <input type="text" name="numero" class="form-control" value="{{ user.numero }}">
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Emprendimiento</label>
                        <input type="text" name="emprendimiento" class="form-control" value="{{ user.emprendimiento }}">
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i>Guardar cambios
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Modal Eliminar Usuario -->
            <div class="modal fade" id="eliminarUsuarioModal{{ user.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminaci√≥n COMPLETA
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="text-center mb-3">
                      <i class="fas fa-user-slash text-danger fa-3x mb-3"></i>
                      <h5>¬øEst√° seguro de eliminar COMPLETAMENTE este usuario?</h5>
                      <div class="alert alert-warning mt-3">
                        <strong>¬°ADVERTENCIA CR√çTICA!</strong><br>
                        Esta acci√≥n eliminar√° permanentemente:
                        <ul class="text-start mt-2">
                          <li>El perfil del usuario</li>
                          <li>Todas sus publicaciones</li>
                          <li>Todos sus comentarios</li>
                          <li>Todas las ruedas de negocio que cre√≥</li>
                          <li>Su participaci√≥n en otras ruedas</li>
                          <li>Todos sus likes en publicaciones y comentarios</li>
                        </ul>
                      </div>
                      <p class="text-muted"><strong>Usuario:</strong> {{ user.nombre }}</p>
                      <div class="alert alert-info mt-2">
                        <small><strong>ID:</strong> {{ user.id }}</small>
                      </div>
                      <p class="text-danger fw-bold">‚ö†Ô∏è Esta acci√≥n no se puede deshacer</p>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form method="POST" action="{{ url_for('eliminar_usuario_dashboard', user_id=user.id) }}" style="display:inline;">
                      <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>Eliminar Completamente
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tabla de publicaciones -->
  <div class="card mb-4 shadow-sm border-0">
    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
      <div>
        <i class="fas fa-box-open me-2"></i> Publicaciones
        <span class="badge bg-light text-success ms-2">{{ total_publicaciones }}</span>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Imagen</th>
              <th>Descripci√≥n</th>
              <th>Usuario</th>
              <th>Fecha</th>
              <th>Likes</th>
              <th class="text-center pe-4">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for pub in publicaciones %}
            <tr class="publication-row">
              <td class="ps-4">
                <div class="publication-image">
                  <img src="{{ pub.url_Imagen or 'https://via.placeholder.com/60' }}" width="60" height="60" class="rounded" alt="Publicaci√≥n">
                </div>
              </td>
              <td>
                <div class="publication-desc">{{ pub.descripcion[:100] }}{% if pub.descripcion|length > 100 %}...{% endif %}</div>
                <small class="text-muted">ID: {{ pub.id[:8] }}...</small>
              </td>
              <td>
                <div class="fw-semibold">{{ pub.userName }}</div>
              </td>
              <td>
                <div class="text-muted small">{{ pub.fechaCreacion }}</div>
              </td>
              <td>
                <span class="badge bg-light text-dark">
                  <i class="fas fa-heart text-danger me-1"></i>{{ pub.likes|length }}
                </span>
              </td>
              <td class="text-center pe-4">
                <div class="btn-group btn-group-sm" role="group">
                  <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editarPublicacionModal{{ pub.id }}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#eliminarPublicacionModal{{ pub.id }}">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>

            <!-- Modal Editar Publicaci√≥n -->
            <div class="modal fade" id="editarPublicacionModal{{ pub.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-edit me-2"></i>Editar Publicaci√≥n
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <form method="POST" action="{{ url_for('editar_publicacion_dashboard', pub_id=pub.id) }}" id="formEditarPublicacion{{ pub.id }}">
                    <div class="modal-body">
                      <div class="alert alert-info">
                        <small><i class="fas fa-info-circle me-1"></i><strong>ID Publicaci√≥n:</strong> {{ pub.id }}</small>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Descripci√≥n *</label>
                        <textarea name="descripcion" class="form-control" rows="4" required>{{ pub.descripcion }}</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">URL Imagen *</label>
                        <input type="text" name="url_Imagen" class="form-control" value="{{ pub.url_Imagen }}" required>
                        <div class="form-text">Ingrese la URL de la imagen de la publicaci√≥n</div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <button type="submit" class="btn btn-success">
                        <i class="fas fa-save me-1"></i>Guardar cambios
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Modal Eliminar Publicaci√≥n -->
            <div class="modal fade" id="eliminarPublicacionModal{{ pub.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminaci√≥n
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="text-center mb-3">
                      <i class="fas fa-trash-alt text-danger fa-3x mb-3"></i>
                      <h5>¬øEst√° seguro de eliminar esta publicaci√≥n?</h5>
                      <p class="text-muted">Esta acci√≥n eliminar√° la publicaci√≥n y todos sus comentarios asociados.</p>
                      <div class="alert alert-warning mt-3">
                        <small><strong>ID:</strong> {{ pub.id }}</small>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form method="POST" action="{{ url_for('eliminar_publicacion_dashboard', pub_id=pub.id) }}" style="display:inline;">
                      <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>Eliminar Publicaci√≥n
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tabla de comentarios -->
  <div class="card mb-4 shadow-sm border-0">
    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
      <div>
        <i class="fas fa-comments me-2"></i> Comentarios
        <span class="badge bg-light text-warning ms-2">{{ total_comentarios }}</span>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Usuario</th>
              <th>Comentario</th>
              <th>Fecha</th>
              <th>Likes</th>
              <th class="text-center pe-4">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for com in comentarios %}
            <tr class="comment-row">
              <td class="ps-4">
                <div class="fw-semibold">{{ com.userName }}</div>
                <small class="text-muted">ID: {{ com.id[:8] }}...</small>
              </td>
              <td>
                <div class="comment-text">{{ com.texto[:80] }}{% if com.texto|length > 80 %}...{% endif %}</div>
              </td>
              <td>
                <div class="text-muted small">{{ com.fechaComentario }}</div>
              </td>
              <td>
                <span class="badge bg-light text-dark">
                  <i class="fas fa-heart text-danger me-1"></i>{{ com.likes_Comentarios|length }}
                </span>
              </td>
              <td class="text-center pe-4">
                <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#eliminarComentarioModal{{ com.id }}">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>

            <!-- Modal Eliminar Comentario -->
            <div class="modal fade" id="eliminarComentarioModal{{ com.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminaci√≥n
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="text-center mb-3">
                      <i class="fas fa-comment-slash text-danger fa-3x mb-3"></i>
                      <h5>¬øEst√° seguro de eliminar este comentario?</h5>
                      <div class="alert alert-light mt-3">
                        <strong>Comentario:</strong> "{{ com.texto }}"
                      </div>
                      <div class="alert alert-warning mt-2">
                        <small><strong>ID:</strong> {{ com.id }}</small>
                      </div>
                      <p class="text-muted">Esta acci√≥n no se puede deshacer.</p>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form method="POST" action="{{ url_for('eliminar_comentario_dashboard', comentario_id=com.id) }}" style="display:inline;">
                      <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>Eliminar Comentario
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tabla de Ruedas de Negocio -->
  <div class="card mb-4 shadow-sm border-0">
    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
      <div>
        <i class="fas fa-handshake me-2"></i> Ruedas de Negocio
        <span class="badge bg-light text-info ms-2">{{ ruedas|length }}</span>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Nombre</th>
              <th>Fecha</th>
              <th>Descripci√≥n</th>
              <th>Participantes</th>
              <th>Estado</th>
              <th class="text-center pe-4">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for rueda in ruedas %}
            <tr class="rueda-row">
              <td class="ps-4">
                <div class="fw-semibold">{{ rueda.nombre }}</div>
                <small class="text-muted">ID: {{ rueda.id[:8] }}...</small>
              </td>
              <td>
                <div class="text-muted">{{ rueda.fecha }}</div>
              </td>
              <td>
                <div class="rueda-desc">{{ rueda.descripcion[:80] }}{% if rueda.descripcion|length > 80 %}...{% endif %}</div>
              </td>
              <td>
                <span class="badge bg-primary">{{ rueda.participantes|length }} participantes</span>
              </td>
              <td>
                {% set estado = rueda.estado if rueda.estado else 'activa' %}
                {% if estado == 'activa' %}
                  <span class="badge bg-success">Activa</span>
                {% elif estado == 'finalizada' %}
                  <span class="badge bg-secondary">Finalizada</span>
                {% elif estado == 'cancelada' %}
                  <span class="badge bg-danger">Cancelada</span>
                {% else %}
                  <span class="badge bg-warning">Planificada</span>
                {% endif %}
              </td>
              <td class="text-center pe-4">
                <div class="btn-group btn-group-sm" role="group">
                  <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editarRuedaModal{{ rueda.id }}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#detallesRuedaModal{{ rueda.id }}">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#eliminarRuedaModal{{ rueda.id }}">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>

            <!-- Modal Editar Rueda de Negocio -->
            <div class="modal fade" id="editarRuedaModal{{ rueda.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-edit me-2"></i>Editar Rueda de Negocio
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <form method="POST" action="{{ url_for('editar_rueda_dashboard', rueda_id=rueda.id) }}" id="formEditarRueda{{ rueda.id }}">
                    <div class="modal-body">
                      <div class="alert alert-info">
                        <small><i class="fas fa-info-circle me-1"></i><strong>ID Rueda:</strong> {{ rueda.id }}</small>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Nombre *</label>
                        <input type="text" name="nombre" class="form-control" value="{{ rueda.nombre }}" required>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Fecha *</label>
                        <input type="date" name="fecha" class="form-control" value="{{ rueda.fecha }}" required>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Descripci√≥n *</label>
                        <textarea name="descripcion" class="form-control" rows="4" required>{{ rueda.descripcion }}</textarea>
                      </div>
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Estado *</label>
                        <select name="estado" class="form-select" required>
                          <option value="planificada" {% if rueda.estado == 'planificada' %}selected{% endif %}>Planificada</option>
                          <option value="activa" {% if rueda.estado == 'activa' or not rueda.estado %}selected{% endif %}>Activa</option>
                          <option value="finalizada" {% if rueda.estado == 'finalizada' %}selected{% endif %}>Finalizada</option>
                          <option value="cancelada" {% if rueda.estado == 'cancelada' %}selected{% endif %}>Cancelada</option>
                        </select>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <button type="submit" class="btn btn-info">
                        <i class="fas fa-save me-1"></i>Guardar cambios
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Modal Detalles Rueda de Negocio -->
            <div class="modal fade" id="detallesRuedaModal{{ rueda.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                  <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-info-circle me-2"></i>Detalles de Rueda de Negocio
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="row">
                      <div class="col-md-6">
                        <h6 class="fw-semibold">Informaci√≥n General</h6>
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item d-flex justify-content-between">
                            <span>Nombre:</span>
                            <strong>{{ rueda.nombre }}</strong>
                          </li>
                          <li class="list-group-item d-flex justify-content-between">
                            <span>Fecha:</span>
                            <strong>{{ rueda.fecha }}</strong>
                          </li>
                          <li class="list-group-item d-flex justify-content-between">
                            <span>Estado:</span>
                            {% set estado = rueda.estado if rueda.estado else 'activa' %}
                            {% if estado == 'activa' %}
                              <span class="badge bg-success">Activa</span>
                            {% elif estado == 'finalizada' %}
                              <span class="badge bg-secondary">Finalizada</span>
                            {% elif estado == 'cancelada' %}
                              <span class="badge bg-danger">Cancelada</span>
                            {% else %}
                              <span class="badge bg-warning">Planificada</span>
                            {% endif %}
                          </li>
                          <li class="list-group-item">
                            <span class="text-muted"><strong>ID:</strong> {{ rueda.id }}</span>
                          </li>
                        </ul>
                      </div>
                      <div class="col-md-6">
                        <h6 class="fw-semibold">Participantes</h6>
                        {% if rueda.participantes and rueda.participantes|length > 0 %}
                          <div class="participants-list">
                            {% for participante in rueda.participantes %}
                              <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-user-circle text-muted me-2"></i>
                                <span>{{ participante.nombre if participante.nombre else 'Usuario ' + loop.index|string }}</span>
                              </div>
                            {% endfor %}
                          </div>
                        {% else %}
                          <p class="text-muted">No hay participantes registrados</p>
                        {% endif %}
                      </div>
                    </div>
                    <div class="row mt-3">
                      <div class="col-12">
                        <h6 class="fw-semibold">Descripci√≥n Completa</h6>
                        <div class="card">
                          <div class="card-body">
                            <p class="mb-0">{{ rueda.descripcion }}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modal Eliminar Rueda de Negocio -->
            <div class="modal fade" id="eliminarRuedaModal{{ rueda.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                      <i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminaci√≥n
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="text-center mb-3">
                      <i class="fas fa-handshake-slash text-danger fa-3x mb-3"></i>
                      <h5>¬øEst√° seguro de eliminar esta rueda de negocio?</h5>
                      <div class="alert alert-warning mt-3">
                        <strong>Advertencia:</strong> Esta acci√≥n eliminar√° la rueda de negocio "{{ rueda.nombre }}" y todos los datos asociados.
                      </div>
                      <div class="alert alert-info mt-2">
                        <small><strong>ID:</strong> {{ rueda.id }}</small>
                      </div>
                      <p class="text-muted">Esta acci√≥n no se puede deshacer.</p>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <form method="POST" action="{{ url_for('eliminar_rueda_dashboard', rueda_id=rueda.id) }}" style="display:inline;">
                      <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>Eliminar Rueda
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<style>
:root {
  --primary-color: #2c3e50;
  --secondary-color: #34495e;
  --accent-color: #3498db;
  --success-color: #27ae60;
  --warning-color: #f39c12;
  --danger-color: #e74c3c;
  --info-color: #17a2b8;
  --light-gray: #ecf0f1;
  --border-radius: 12px;
  --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  --transition: all 0.3s ease;
}

/* Estilos generales para el dashboard */
.stat-card {
  border-radius: var(--border-radius);
  transition: var(--transition);
  border: none;
  overflow: hidden;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
}

.stat-icon-container {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
}

.card-header {
  border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
  font-weight: 600;
  padding: 1rem 1.5rem;
}

/* Tablas mejoradas */
.table {
  margin-bottom: 0;
}

.table th {
  border-top: none;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.85rem;
  letter-spacing: 0.5px;
  padding: 1rem 0.75rem;
}

.table td {
  padding: 1rem 0.75rem;
  vertical-align: middle;
}

.user-row:hover,
.publication-row:hover,
.comment-row:hover,
.rueda-row:hover {
  background-color: rgba(52, 152, 219, 0.05);
  transition: var(--transition);
}

/* Avatares e im√°genes */
.user-avatar img,
.publication-image img {
  transition: var(--transition);
}

.user-avatar img:hover,
.publication-image img:hover {
  transform: scale(1.1);
}

/* Badges personalizados */
.badge {
  font-size: 0.75rem;
  font-weight: 500;
  padding: 0.35em 0.65em;
}

/* Botones de acci√≥n */
.btn-group .btn {
  border-radius: 6px;
  margin: 0 2px;
  transition: var(--transition);
}

.btn-outline-primary:hover {
  background-color: var(--accent-color);
  border-color: var(--accent-color);
  color: white;
}

.btn-outline-info:hover {
  background-color: var(--info-color);
  border-color: var(--info-color);
  color: white;
}

.btn-outline-danger:hover {
  background-color: var(--danger-color);
  border-color: var(--danger-color);
  color: white;
}

/* Modales personalizados */
.modal-content {
  border-radius: var(--border-radius);
  border: none;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.modal-header {
  border-radius: var(--border-radius) var(--border-radius) 0 0;
  padding: 1.25rem 1.5rem;
}

.modal-body {
  padding: 1.5rem;
}

.modal-footer {
  padding: 1rem 1.5rem;
  border-top: 1px solid #dee2e6;
}

/* Texto truncado */
.publication-desc,
.comment-text,
.rueda-desc {
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Lista de participantes */
.participants-list {
  max-height: 200px;
  overflow-y: auto;
}

.participants-list::-webkit-scrollbar {
  width: 6px;
}

.participants-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.participants-list::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

/* Responsive */
@media (max-width: 768px) {
  .stat-card .card-body {
    text-align: center;
  }
  
  .stat-icon-container {
    margin: 0 auto 0.5rem;
  }
  
  .table-responsive {
    font-size: 0.9rem;
  }
  
  .btn-group {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }
  
  .btn-group .btn {
    margin: 0;
  }
  
  .publication-desc,
  .comment-text,
  .rueda-desc {
    max-width: 150px;
  }
}

/* Animaciones */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.card {
  animation: fadeIn 0.5s ease-out;
}

.modal.fade .modal-dialog {
  animation: fadeIn 0.3s ease-out;
}

/* Scroll personalizado */
.table-responsive::-webkit-scrollbar {
  height: 6px;
}

.table-responsive::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.table-responsive::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* Estados de las ruedas */
.badge.bg-success { background-color: var(--success-color) !important; }
.badge.bg-warning { background-color: var(--warning-color) !important; }
.badge.bg-danger { background-color: var(--danger-color) !important; }
.badge.bg-secondary { background-color: var(--secondary-color) !important; }
.badge.bg-primary { background-color: var(--primary-color) !important; }
.badge.bg-info { background-color: var(--info-color) !important; }

/* Flash messages */
.alert {
  border-radius: var(--border-radius);
  border: none;
}

.alert-success {
  background-color: #d1f2eb;
  color: #27ae60;
  border-left: 4px solid #27ae60;
}

.alert-danger {
  background-color: #fadbd8;
  color: #e74c3c;
  border-left: 4px solid #e74c3c;
}

.alert-info {
  background-color: #d6eaf8;
  color: #3498db;
  border-left: 4px solid #3498db;
}

.alert-warning {
  background-color: #fdebd0;
  color: #f39c12;
  border-left: 4px solid #f39c12;
}
</style>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<script>
// Script para mejorar la interactividad
document.addEventListener('DOMContentLoaded', function() {
  console.log('‚úÖ Dashboard administrativo cargado correctamente');

  // Tooltips para botones
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });

  // Confirmaci√≥n para eliminaciones
  const deleteButtons = document.querySelectorAll('.btn-outline-danger');
  deleteButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      if (!confirm('¬øEst√° seguro de que desea eliminar este elemento?')) {
        e.preventDefault();
      }
    });
  });

  // Efecto de carga para botones de guardar
  const saveButtons = document.querySelectorAll('.modal-footer .btn-primary, .modal-footer .btn-success, .modal-footer .btn-info');
  saveButtons.forEach(button => {
    button.addEventListener('click', function() {
      const form = this.closest('form');
      if (form.checkValidity()) {
        const originalText = this.innerHTML;
        this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Guardando...';
        this.disabled = true;
        
        // Simular guardado
        setTimeout(() => {
          this.innerHTML = originalText;
          this.disabled = false;
        }, 1500);
      }
    });
  });

  // Formatear fechas para inputs date
  const dateInputs = document.querySelectorAll('input[type="date"]');
  dateInputs.forEach(input => {
    if (input.value) {
      const date = new Date(input.value);
      if (!isNaN(date)) {
        input.value = date.toISOString().split('T')[0];
      }
    }
  });

  // Auto-ocultar mensajes flash despu√©s de 5 segundos
  const flashMessages = document.querySelectorAll('.alert');
  flashMessages.forEach(alert => {
    setTimeout(() => {
      const bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    }, 5000);
  });
});

// Debug para formularios de ruedas
function debugSubmit(ruedaId) {
    console.log('üîÑ Intentando enviar formulario para rueda:', ruedaId);
    
    const form = document.getElementById('formEditarRueda' + ruedaId);
    const formData = new FormData(form);
    
    console.log('üì§ Datos del formulario:');
    for (let [key, value] of formData.entries()) {
        console.log(`  ${key}: ${value}`);
    }
    console.log('üìç URL de destino:', form.action);
    
    // Verificar que todos los campos requeridos est√©n llenos
    const nombre = form.querySelector('input[name="nombre"]').value;
    const fecha = form.querySelector('input[name="fecha"]').value;
    const descripcion = form.querySelector('textarea[name="descripcion"]').value;
    
    if (!nombre || !fecha || !descripcion) {
        console.log('‚ùå Campos requeridos vac√≠os');
        alert('Por favor, complete todos los campos obligatorios (*)');
        return false;
    }
    
    console.log('‚úÖ Formulario v√°lido, enviando...');
    return true;
}

// Verificar que todos los formularios est√©n correctamente configurados
function verifyForms() {
    console.log('üîç Verificando formularios...');
    
    const forms = {
        usuarios: document.querySelectorAll('form[action*="editar_usuario_dashboard"]'),
        publicaciones: document.querySelectorAll('form[action*="editar_publicacion_dashboard"]'),
        ruedas: document.querySelectorAll('form[action*="editar_rueda_dashboard"]')
    };
    
    console.log(`üìä Formularios encontrados:`);
    console.log(`  Usuarios: ${forms.usuarios.length}`);
    console.log(`  Publicaciones: ${forms.publicaciones.length}`);
    console.log(`  Ruedas: ${forms.ruedas.length}`);
    
    return true;
}

// Ejecutar verificaci√≥n al cargar
setTimeout(verifyForms, 1000);
</script>

{% endblock %}